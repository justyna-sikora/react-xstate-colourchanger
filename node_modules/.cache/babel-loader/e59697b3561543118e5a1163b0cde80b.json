{"ast":null,"code":"import _slicedToArray from \"/mnt/c/users/justa/documents/assignment2/react-xstate-colourchanger/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/mnt/c/users/justa/documents/assignment2/react-xstate-colourchanger/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n\nvar _jsxFileName = \"/mnt/c/users/justa/documents/assignment2/react-xstate-colourchanger/src/index.tsx\",\n    _s = $RefreshSig$();\n\nimport \"./styles.scss\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Machine, assign, send } from \"xstate\";\nimport { useMachine, asEffect } from \"@xstate/react\";\nimport { inspect } from \"@xstate/inspect\";\nimport { dmMachine } from \"./dmAppointment\";\ninspect({\n  url: \"https://statecharts.io/inspect\",\n  iframe: false\n});\nimport { useSpeechSynthesis, useSpeechRecognition } from 'react-speech-kit';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction say(text) {\n  return send(_context => ({\n    type: \"SPEAK\",\n    value: text\n  }));\n}\n\nfunction listen() {\n  return send('LISTEN');\n}\n\nconst newMachine = Machine({\n  states: {\n    init: {\n      on: {\n        CLICK: 'who'\n      }\n    },\n    welcome: {\n      id: \"wlcm\",\n      initial: \"prompt\",\n      on: {\n        RECOGNISED: {\n          target: 'query',\n          actions: assign(context => {\n            return {\n              query: context.recResult\n            };\n          })\n        }\n      },\n      states: {\n        prompt: {\n          entry: say(\"What would you like to do?\"),\n          on: {\n            ENDSPEECH: \"ask\"\n          }\n        },\n        ask: {\n          entry: listen()\n        },\n        nomatch: {\n          entry: say(\"Sorry I don't understand.\"),\n          on: {\n            ENDSPEECH: \"prompt\"\n          }\n        }\n      }\n    },\n    query: {\n      invoke: {\n        id: 'rasa',\n        src: (context, event) => nluRequest(context.query),\n        onDone: {\n          target: 'menu',\n          actions: [assign((context, event) => {\n            return {\n              intentbest: event.data\n            };\n          }), (context, event) => console.log(event.data)]\n        },\n        onError: {\n          target: 'welcome',\n          actions: (context, event) => console.log(event.data)\n        }\n      }\n    },\n    menu: {\n      initial: \"prompt\",\n      on: {\n        ENDSPEECH: [{\n          cond: context => context.intentbest.intent.name === \"timer\",\n          target: \"Timer\"\n        }, {\n          cond: context => context.intentbest.intent.name === \"todo_item\",\n          target: \"TODOitem\"\n        }, {\n          cond: context => context.intentbest.intent.name === \"appointment\",\n          target: \"dm\"\n        }, {\n          target: \".nomatch\"\n        }]\n      },\n      states: {\n        prompt: {\n          entry: send(context => ({\n            type: \"SPEAK\",\n            value: \"OK, noted!\"\n          }))\n        },\n        nomatch: {\n          entry: say(\"Oh sorry, it seems that I can't help you with that at the moment.\"),\n          on: {\n            ENDSPEECH: \"#wlcm\"\n          }\n        }\n      }\n    },\n    TODOitem: {\n      initial: \"prompt\",\n      on: {\n        ENDSPEECH: \"init\"\n      },\n      states: {\n        prompt: {\n          entry: say(\"Welcome to the TODOitem app\")\n        }\n      }\n    },\n    Timer: {\n      initial: \"prompt\",\n      on: {\n        ENDSPEECH: \"init\"\n      },\n      states: {\n        prompt: {\n          entry: say(\"Welcome to the Timer app\")\n        }\n      }\n    },\n    dm: _objectSpread({}, dmMachine)\n  }\n});\nconst machine = Machine({\n  id: 'root',\n  type: 'parallel',\n  states: {\n    dm: _objectSpread({}, newMachine),\n    asrtts: {\n      initial: 'idle',\n      states: {\n        idle: {\n          on: {\n            LISTEN: 'recognising',\n            SPEAK: {\n              target: 'speaking',\n              actions: assign((_context, event) => {\n                return {\n                  ttsAgenda: event.value\n                };\n              })\n            }\n          }\n        },\n        recognising: {\n          entry: 'recStart',\n          exit: 'recStop',\n          on: {\n            ASRRESULT: {\n              actions: ['recLogResult', assign((_context, event) => {\n                return {\n                  recResult: event.value\n                };\n              })],\n              target: '.match'\n            },\n            RECOGNISED: 'idle'\n          },\n          states: {\n            match: {\n              entry: send('RECOGNISED')\n            }\n          }\n        },\n        speaking: {\n          entry: 'ttsStart',\n          on: {\n            ENDSPEECH: 'idle'\n          }\n        }\n      }\n    }\n  }\n}, {\n  actions: {\n    recLogResult: context => {\n      /* context.recResult = event.recResult; */\n      console.log('<< ASR: ' + context.recResult);\n    },\n    test: () => {\n      console.log('test');\n    },\n    logIntent: context => {\n      /* context.nluData = event.data */\n      console.log('<< NLU intent: ' + context.nluData.intent.name);\n    }\n  }\n});\n\nconst ReactiveButton = props => {\n  switch (true) {\n    case props.state.matches({\n      asrtts: 'recognising'\n    }):\n      return /*#__PURE__*/_jsxDEV(\"button\", _objectSpread(_objectSpread({\n        type: \"button\",\n        className: \"glow-on-hover\",\n        style: {\n          animation: \"glowing 20s linear\"\n        }\n      }, props), {}, {\n        children: \"Listening...\"\n      }), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 17\n      }, this);\n\n    case props.state.matches({\n      asrtts: 'speaking'\n    }):\n      return /*#__PURE__*/_jsxDEV(\"button\", _objectSpread(_objectSpread({\n        type: \"button\",\n        className: \"glow-on-hover\",\n        style: {\n          animation: \"bordering 1s infinite\"\n        }\n      }, props), {}, {\n        children: \"Speaking...\"\n      }), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this);\n\n    default:\n      return /*#__PURE__*/_jsxDEV(\"button\", _objectSpread(_objectSpread({\n        type: \"button\",\n        className: \"glow-on-hover\"\n      }, props), {}, {\n        children: \"Click to start\"\n      }), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }, this);\n  }\n};\n\n_c = ReactiveButton;\n\nfunction App() {\n  _s();\n\n  const _useSpeechSynthesis = useSpeechSynthesis({\n    onEnd: () => {\n      send('ENDSPEECH');\n    }\n  }),\n        speak = _useSpeechSynthesis.speak,\n        cancel = _useSpeechSynthesis.cancel,\n        speaking = _useSpeechSynthesis.speaking;\n\n  const _useSpeechRecognition = useSpeechRecognition({\n    onResult: result => {\n      send({\n        type: \"ASRRESULT\",\n        value: result\n      });\n    }\n  }),\n        listen = _useSpeechRecognition.listen,\n        listening = _useSpeechRecognition.listening,\n        stop = _useSpeechRecognition.stop;\n\n  const _useMachine = useMachine(machine, {\n    devTools: true,\n    actions: {\n      recStart: asEffect(() => {\n        console.log('Ready to receive a color command.');\n        listen({\n          interimResults: false,\n          continuous: true\n        });\n      }),\n      recStop: asEffect(() => {\n        console.log('Recognition stopped.');\n        stop();\n      }),\n      changeColour: asEffect(context => {\n        console.log('Repainting...');\n        document.body.style.background = context.recResult;\n      }),\n      ttsStart: asEffect((context, effect) => {\n        console.log('Speaking...');\n        speak({\n          text: context.ttsAgenda\n        });\n      }),\n      ttsCancel: asEffect((context, effect) => {\n        console.log('TTS STOP...');\n        cancel();\n      })\n      /* speak: asEffect((context) => {\n      * console.log('Speaking...');\n       *     speak({text: context.ttsAgenda })\n       * } */\n\n    }\n  }),\n        _useMachine2 = _slicedToArray(_useMachine, 3),\n        current = _useMachine2[0],\n        send = _useMachine2[1],\n        service = _useMachine2[2];\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(ReactiveButton, {\n      state: current,\n      onClick: () => send('CLICK')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 262,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"RIIO137itlHAPnsUEd30120dxYQ=\", false, function () {\n  return [useSpeechSynthesis, useSpeechRecognition, useMachine];\n});\n\n_c2 = App;\n;\n/* RASA API\n *  */\n\nconst proxyurl = \"https://cors-anywhere.herokuapp.com/\";\nconst rasaurl = 'https://assignment2nlu.herokuapp.com/model/parse';\n\nconst nluRequest = text => fetch(new Request(proxyurl + rasaurl, {\n  method: 'POST',\n  headers: {\n    'Origin': 'http://maraev.me'\n  },\n  // only required with proxy\n  body: \"{\\\"text\\\": \\\"\".concat(text, \"\\\"}\")\n})).then(data => data.json());\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render( /*#__PURE__*/_jsxDEV(App, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 288,\n  columnNumber: 5\n}, this), rootElement);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ReactiveButton\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"sources":["/mnt/c/users/justa/documents/assignment2/react-xstate-colourchanger/src/index.tsx"],"names":["React","ReactDOM","Machine","assign","send","useMachine","asEffect","inspect","dmMachine","url","iframe","useSpeechSynthesis","useSpeechRecognition","say","text","_context","type","value","listen","newMachine","states","init","on","CLICK","welcome","id","initial","RECOGNISED","target","actions","context","query","recResult","prompt","entry","ENDSPEECH","ask","nomatch","invoke","src","event","nluRequest","onDone","intentbest","data","console","log","onError","menu","cond","intent","name","TODOitem","Timer","dm","machine","asrtts","idle","LISTEN","SPEAK","ttsAgenda","recognising","exit","ASRRESULT","match","speaking","recLogResult","test","logIntent","nluData","ReactiveButton","props","state","matches","animation","App","onEnd","speak","cancel","onResult","result","listening","stop","devTools","recStart","interimResults","continuous","recStop","changeColour","document","body","style","background","ttsStart","effect","ttsCancel","current","service","proxyurl","rasaurl","fetch","Request","method","headers","then","json","rootElement","getElementById","render"],"mappings":"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","sourcesContent":["import \"./styles.scss\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Machine, assign, send, State } from \"xstate\";\nimport { useMachine, asEffect } from \"@xstate/react\";\nimport { inspect } from \"@xstate/inspect\";\nimport { dmMachine } from \"./dmAppointment\";\n\n\ninspect({\n    url: \"https://statecharts.io/inspect\",\n    iframe: false\n});\n\nimport { useSpeechSynthesis, useSpeechRecognition } from 'react-speech-kit';\n\nfunction say(text: string): Action<SDSContext, SDSEvent> {\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\n}\n\nfunction listen(): Action<SDSContext, SDSEvent> {\n    return send('LISTEN')\n}\n\n\nconst newMachine = Machine<SDSContext, any, SDSEvent>({\n    states: { init: {\n        on: {\n            CLICK: 'who'\n        }\n    },\n\n    welcome: {\n        id: \"wlcm\",\n        initial: \"prompt\",\n        on: {\n        RECOGNISED: {\n            target: 'query',\n            actions: assign((context) => { return { query: context.recResult } }),\n                }\n            },\n            states: {\n                prompt: {\n                    entry: say(\"What would you like to do?\"),\n                    on: { ENDSPEECH: \"ask\" }\n                },\n                ask: {\n                    entry: listen()\n                },\n                nomatch: {\n                    entry: say(\"Sorry I don't understand.\"),\n                    on: { ENDSPEECH: \"prompt\" }\n                }\n            }\n    },\n    query: {\n        invoke: {\n        id: 'rasa',\n                src: (context, event) => nluRequest(context.query),\n        onDone: {\n                target: 'menu',\n                    actions: [assign((context, event) => { return {intentbest: event.data }}),\n                            (context:SDSContext, event:any) => console.log(event.data)]\n                },\n        onError: {\n                    target: 'welcome',\n                    actions: (context,event) => console.log(event.data)\n                }\n            }\n    },\nmenu: {\n        initial: \"prompt\",\n        on: {\n            ENDSPEECH: [{\n            cond: (context) => context.intentbest.intent.name === \"timer\",\n            target: \"Timer\"\n\n            },\n            {cond: (context) => context.intentbest.intent.name === \"todo_item\",\n            target: \"TODOitem\"\n            },\n\n            {cond: (context) => context.intentbest.intent.name === \"appointment\",\n            target: \"dm\"\n\n            },\n            { target: \".nomatch\"}]\n        },\n        states: {\n            prompt: {\n                entry: send((context) => ({\n                    type: \"SPEAK\",\n                    value: `OK, noted!`\n                }))\n            },\n            nomatch: {entry: say(\"Oh sorry, it seems that I can't help you with that at the moment.\"),\n            on: { ENDSPEECH: \"#wlcm\" }\n        },\n        }\n    },\n    TODOitem: {\n        initial: \"prompt\",\n        on: { ENDSPEECH: \"init\" },\n        states: {\n            prompt: { entry: say(\"Welcome to the TODOitem app\")\n        }\n       }\n    },\n    Timer: {\n        initial: \"prompt\",\n        on: { ENDSPEECH: \"init\" },\n        states: {\n    prompt: { entry: say (\"Welcome to the Timer app\")\n        }\n        }\n    },\n    dm: {\n        ...dmMachine\n    }\n\n    }\n})\n\nconst machine = Machine<SDSContext, any, SDSEvent>({\n    id: 'root',\n    type: 'parallel',\n    states: {\n        dm: {\n            ...newMachine\n        },\n        asrtts: {\n            initial: 'idle',\n            states: {\n                idle: {\n                    on: {\n                        LISTEN: 'recognising',\n                        SPEAK: {\n                            target: 'speaking',\n                            actions: assign((_context, event) => { return { ttsAgenda: event.value } })\n                        }\n                    }\n                },\n                recognising: {\n                    entry: 'recStart',\n                    exit: 'recStop',\n                    on: {\n                        ASRRESULT: {\n                            actions: ['recLogResult',\n                                assign((_context, event) => { return { recResult: event.value } })],\n                            target: '.match'\n                        },\n                        RECOGNISED: 'idle'\n                    },\n                    states: {\n                        match: {\n                            entry: send('RECOGNISED'),\n                        },\n                    }\n                },\n                speaking: {\n                    entry: 'ttsStart',\n                    on: {\n                        ENDSPEECH: 'idle',\n                    }\n                }\n            }\n        }\n    },\n},\n    {\n        actions: {\n            recLogResult: (context: SDSContext) => {\n                /* context.recResult = event.recResult; */\n                console.log('<< ASR: ' + context.recResult);\n            },\n            test: () => {\n                console.log('test')\n            },\n            logIntent: (context: SDSContext) => {\n                /* context.nluData = event.data */\n                console.log('<< NLU intent: ' + context.nluData.intent.name)\n            }\n        },\n    });\n\n\n\ninterface Props extends React.HTMLAttributes<HTMLElement> {\n    state: State<SDSContext, any, any, any>;\n}\nconst ReactiveButton = (props: Props): JSX.Element => {\n    switch (true) {\n        case props.state.matches({ asrtts: 'recognising' }):\n            return (\n                <button type=\"button\" className=\"glow-on-hover\"\n                    style={{ animation: \"glowing 20s linear\" }} {...props}>\n                    Listening...\n                </button>\n            );\n        case props.state.matches({ asrtts: 'speaking' }):\n            return (\n                <button type=\"button\" className=\"glow-on-hover\"\n                    style={{ animation: \"bordering 1s infinite\" }} {...props}>\n                    Speaking...\n                </button>\n            );\n        default:\n            return (\n                <button type=\"button\" className=\"glow-on-hover\" {...props}>\n                    Click to start\n                </button >\n            );\n    }\n}\n\nfunction App() {\n    const { speak, cancel, speaking } = useSpeechSynthesis({\n        onEnd: () => {\n            send('ENDSPEECH');\n        },\n    });\n    const { listen, listening, stop } = useSpeechRecognition({\n        onResult: (result: any) => {\n            send({ type: \"ASRRESULT\", value: result });\n        },\n    });\n    const [current, send, service] = useMachine(machine, {\n        devTools: true,\n        actions: {\n            recStart: asEffect(() => {\n                console.log('Ready to receive a color command.');\n                listen({\n                    interimResults: false,\n                    continuous: true\n                });\n            }),\n            recStop: asEffect(() => {\n                console.log('Recognition stopped.');\n                stop()\n            }),\n            changeColour: asEffect((context) => {\n                console.log('Repainting...');\n                document.body.style.background = context.recResult;\n            }),\n            ttsStart: asEffect((context, effect) => {\n                console.log('Speaking...');\n                speak({ text: context.ttsAgenda })\n            }),\n            ttsCancel: asEffect((context, effect) => {\n                console.log('TTS STOP...');\n                cancel()\n            })\n            /* speak: asEffect((context) => {\n\t     * console.log('Speaking...');\n             *     speak({text: context.ttsAgenda })\n             * } */\n        }\n    });\n\n\n    return (\n        <div className=\"App\">\n            <ReactiveButton state={current} onClick={() => send('CLICK')} />\n        </div>\n    )\n};\n\n\n\n\n\n\n\n/* RASA API\n *  */\nconst proxyurl = \"https://cors-anywhere.herokuapp.com/\";\nconst rasaurl = 'https://assignment2nlu.herokuapp.com/model/parse'\nconst nluRequest = (text: string) =>\n    fetch(new Request(proxyurl + rasaurl, {\n        method: 'POST',\n        headers: { 'Origin': 'http://maraev.me' }, // only required with proxy\n        body: `{\"text\": \"${text}\"}`\n    }))\n        .then(data => data.json());\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n    <App />,\n    rootElement);\n"]},"metadata":{},"sourceType":"module"}